<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="TV Show Project for Adnaan (AdnaanA) at CYF" />
  <title>TV Show Project | Adnaan (AdnaanA)</title>

  <style>
            /* ===== Shows container ===== */
            #shows-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 1100px;
            margin: 20px auto;
            width: 100%;
            box-sizing: border-box;
        }

        /* ===== Show Card ===== */
        .show-card {
            width: 100%;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            gap: 20px;
            box-sizing: border-box;
        }

        .show-card img {
            width: 180px;
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            flex-shrink: 0;
        }

        .show-card div {
            flex: 1;
            min-width: 250px;
        }

        .show-card h2 {
            margin: 0 0 6px;
        }

        .show-card button {
            margin-top: 12px;
            padding: 10px 14px;
            border: none;
            background-color: #f3a702;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .show-card button:hover {
            background-color: #f7d07d;
        }
            /* ===== Scroll to Top ===== */
            #scrollTopBtn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 99;
            font-size: 38px;
            border: none;
            outline: none;
            background-color: #f3a702;
            color: white;
            cursor: pointer;
            padding: 16px 20px;
            border-radius: 50%;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: background 0.3s;
        }

        #scrollTopBtn:hover {
            background-color: #f7c14f;
        }
  </style>
  <link href="style.css" rel="stylesheet" />
</head>
<body>

  <header>
    <h1>Adnaan's TV Show Project</h1>
  </header>

  <nav>
    <div class="menu">
      <div class="buttons">
        <button onclick="location.href='index.html'">Home</button>
        <button onclick="location.href='episodes.html'">TV Shows</button>
      </div>
  
      <!-- Search moved here -->
      <input
        id="showSearch"
        type="text"
        placeholder="Search shows..."
        class="nav-search"
      />
    </div>
  </nav>
    
  <section id="data-origin">
    <p>
      Data originally from
      <a href="https://www.tvmaze.com/" target="_blank">TVMaze.com</a>
    </p>
  </section>


  <section id="shows-container" aria-label="TV Shows"></section>

  <!-- Scroll to Top Button -->
  <button id="scrollTopBtn" title="Go to top">â†‘</button>
  
  <script>
      let _showsCache = null;
  
      function truncateSummary(text) {
          let words = text.split(/\s+/);
          if (words.length > 20) {
              return words.slice(0, 20).join(" ") + "...";
          }
          return text;
      }
  
      async function loadShowsOnce() {
          if (_showsCache) return _showsCache;
          const res = await fetch("https://api.tvmaze.com/shows");
          _showsCache = await res.json();
          return _showsCache;
      }
  
      function renderShows(shows) {
          const container = document.getElementById("shows-container");
          container.innerHTML = "";
  
          shows.forEach(show => {
              const card = document.createElement("article");
              card.classList.add("show-card");
  
              const cleanSummary = (show.summary || "").replace(/<[^>]+>/g, "");
              const truncated = truncateSummary(cleanSummary);
  
              card.innerHTML = `
                  <img src="${show.image?.medium || "https://placehold.co/300x450"}" alt="${show.name}">
                  <div>
                      <h2>${show.name}</h2>
                      <p><strong>Genres:</strong> ${show.genres.join(", ")}</p>
                      <p><strong>Status:</strong> ${show.status}</p>
                      <p><strong>Rating:</strong> ${show.rating?.average ?? "N/A"}</p>
                      <p><strong>Runtime:</strong> ${show.runtime || "?"} min</p>
                      <p>${truncated}</p>
                      <button class="open-show" data-id="${show.id}">View episodes</button>
                  </div>
              `;
  
              container.appendChild(card);
          });
      }
  
      document.getElementById("showSearch").addEventListener("input", async (e) => {
          const q = e.target.value.toLowerCase();
          const all = await loadShowsOnce();
  
          const filtered = all.filter(show => {
              const summary = (show.summary || "").replace(/<[^>]+>/g, "").toLowerCase();
              return (
                  show.name.toLowerCase().includes(q) ||
                  summary.includes(q) ||
                  show.genres.join(" ").toLowerCase().includes(q)
              );
          });
  
          renderShows(filtered);
      });
  
      document.addEventListener("click", (e) => {
          if (!e.target.classList.contains("open-show")) return;
          const id = e.target.dataset.id;
          window.location.href = `episodes.html?showId=${id}`;
      });
  
      (async () => {
          const shows = await loadShowsOnce();
          renderShows(shows);
      })();
  
      // Scroll to top button
      const scrollBtn = document.getElementById("scrollTopBtn");
      window.onscroll = function() {
          if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
              scrollBtn.style.display = "block";
          } else {
              scrollBtn.style.display = "none";
          }
      };
      scrollBtn.addEventListener("click", () => {
          window.scrollTo({ top: 0, behavior: "smooth" });
      });
  </script>
  
  <script>
    // Select all nav buttons
    const navButtons = document.querySelectorAll('nav button');
  
    // Get current page filename (e.g., "home.html" or "index.html")
    let currentPage = window.location.pathname.split('/').pop();

    // Netlify root fix
    if (currentPage === "") {
      currentPage = "index.html";
    }
    navButtons.forEach(btn => {
      // Extract href from the onclick attribute
      const onclickAttr = btn.getAttribute('onclick'); // e.g., "location.href='home.html'"
      if (!onclickAttr) return;
  
      const match = onclickAttr.match(/'(.+?)'/);
      if (!match) return;
  
      const href = match[1];
  
      // Add or remove 'active' class
      if (href === currentPage) {
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    });
  </script>

</body>
</html>
